---
title: "Прогноз посещаемости сервисов Яндекс.Картинки и Яндекс.Погода"
output: html_document
header-includes:
- \usepackage[russian]{babel}
---
Для начала найдем необходимые нам данные на сайте stat.yandex.ru в разделах **Погода** и **Картинки** и скачаем их в формате **.csv** за весь доступный период по России в целом.

Для анализа будем использовать язык **R** и среду **R Studio**.

## Простой анализ компонент временного ряда

Загрузим данные:

```{r}
images <- read.csv("Images_Russia.csv", sep = ";")
weather <- read.csv("Weather_Russia.csv", sep = ";")
```

И взлянем на них:

```{r}
head(images)
head(weather)
```

Наши данные, очевидно, представляют собой временные ряды, следовательно, именно так и мы и будем представлять их в R. Но прежде нужно визуализировать наши ряды и, заодно, их тренды (используя линейный фильтр).

```{r}
par(mfrow=c(2,2))
plot(images$Monthly / 10^6, type = "l", xlab = "Time", ylab = "Millon of People", main = "Monthly, Users of Yandex.Images")
img <- filter(images$Monthly / 10^6, filter = rep(1/25, 25))
lines(img, col = "red")
grid()

plot(images$Average.daily / 10^6, type = "l", xlab = "Time", ylab = "Millon of people", main = "Avg Daily, Users of Yandex.Images")
img <- filter(images$Average.daily / 10^6, filter = rep(1/25, 25))
lines(img, col = "red")
grid()

plot(weather$Monthly / 10^6, type = "l", xlab = "Time", ylab = "Millon of People", main = "Monthly, Users of Yandex.Weahter")
img <- filter(weather$Monthly / 10^6, filter = rep(1/25, 25))
lines(img, col = "red")
grid()

plot(weather$Average.daily / 10^6, type = "l", xlab = "Time", ylab = "Millon of People", main = "Avg. Daily, Users of Yandex.Weahter")
img <- filter(weather$Average.daily / 10^6, filter = rep(1/25, 25))
lines(img, col = "red")
grid()
```

Вообще, у временных рядов есть три ключевых состовляющих: тренд, сезонная компонента и ошибка прогноза.

Для того, чтобы получить эти составляющие для наших данных, наконец представим их в виде временного ряда и воспользуемся функцией **stl**:

```{r}
images.monthly <- ts(images$Monthly, start = c(2008, 5), end = c(2015, 10), frequency = 12)
plot(stl(images.monthly, s.window="periodic"))

images.avg.daily <- ts(images$Average.daily, start = c(2008, 5), end = c(2015, 10), frequency = 12)
plot(stl(images.avg.daily, s.window="periodic"))

weather.monthly <- ts(weather$Monthly, start = c(2008, 5), end = c(2015, 10), frequency = 12)
plot(stl(weather.monthly, s.window="periodic"))

weather.avg.daily <- ts(weather$Average.daily, start = c(2008, 5), end = c(2015, 10), frequency = 12)
plot(stl(weather.avg.daily, s.window="periodic"))
```

## Прогнозирование

Как видим, в структуре наших данных есть сложивишиеся тренд и сезонность, так что мы можем использовать Метод Хольта - Винтерса (экспоненциального сглаживания) для прогнозирования временных рядов.

```{r}
par(mfrow=c(2,2))
plot(images.monthly / 10^6, xlab = "Time", ylab = "Millon of People", main = "Monthly, Yandex.Images")
lines(HoltWinters(images.monthly / 10^6, gamma=F)$fitted[, 2], col = "red")
grid()

plot(images.avg.daily / 10^6,xlab = "Time", ylab = "Millon of People",  main = "Avg. Daily, Yandex.Images")
lines(HoltWinters(images.avg.daily / 10^6, gamma=F)$fitted[, 2], col = "red")
grid()

plot(weather.monthly / 10^6,xlab = "Time", ylab = "Millon of People", main = "Monthly, Yandex.Weather")
lines(HoltWinters(weather.monthly / 10^6, gamma=F)$fitted[, 2], col = "red")
grid()

plot(weather.avg.daily / 10^6, xlab = "Time", ylab = "Millon of People", main = "Avg. Daily, Yandex.Weather")
lines(HoltWinters(weather.avg.daily / 10^6, gamma=F)$fitted[, 2], col = "red")
grid()
```

Собственно, теперь осталось лишь предсказать аудитории сервисов Яндекс.Картинки и Яндекс.Погода на два года вперед с помощью функции **predict**:

```{r}
par(mfrow=c(2,2))
plot(images.monthly / 10^6, xlab = "Time", ylab = "Millon of People",  xlim =c(2008, 2018), ylim = c(0, 50), main = "Monthly, Yandex.Images")
lines(predict(HoltWinters(images.monthly / 10^6), n.ahead = 24), col = "red")
grid()

plot(images.avg.daily / 10^6, xlab = "Time", ylab = "Millon of People", xlim =c(2008, 2018), ylim = c(0, 10), main = "Avg. Daily, Yandex.Images")
lines(predict(HoltWinters(images.avg.daily / 10^6), n.ahead = 24), col = "red")
grid()

plot(weather.monthly / 10^6, xlab = "Time", ylab = "Millon of People", xlim =c(2008, 2018), ylim = c(0, 30), main = "Monthly, Yandex.Weather")
lines(predict(HoltWinters(weather.monthly / 10^6), n.ahead = 24), col = "red")
grid()

plot(weather.avg.daily / 10^6, xlab = "Time", ylab = "Millon of People", xlim =c(2008, 2018), ylim = c(0, 10), main = "Avg. Daily, Yandex.Weather")
lines(predict(HoltWinters(weather.avg.daily / 10^6), n.ahead = 24), col = "red")
grid()
```

Предсказание посещаемости сервиса **Яндекс.Картинки** на 2 года:

| Месяц.Год | Месячная аудитория | Средняя дневная аудитория|
|:-----: | :-----:| :-----: |
| Ноябрь 2015 | 29303822 | 4543815  |
| Декабрь 2015 | 30191808 | 4687992  |
| Январь 2016 | 30518987        | 4746091  |
| Февраль 2016 | 30811778  | 4958768  |
| Март 2016 | 31596943   |  5013187 |
| Апрель 2016 | 31471689   |  4982451   |
| Май 2016 | 30652366   | 4901408   |
| Июнь 2016 | 31311735   | 4896415 |
| Июль 2016 | 31562584 |   4784147   |
| Август 2016 | 31784090   | 4894393 |
| Сентябрь 2016 | 32550252   | 5129020   |
| Октябрь 2016 | 33772556   | 5375739   |
| Ноябрь 2016 | 33737781   | 5339554  |
| Декабрь 2016 | 34625766 | 5483731 |
| Январь 2017 | 34952945  | 5541830   |
| Февраль 2017 | 35245737   | 5754507  |
| Март 2017 | 36030901   | 5808925   |
| Апрель 2017 | 35905648   | 5778190   |
| Май 2017 | 35086324   |5697146   |
| Июнь 2017 | 35745693  | 5692154   |
| Июль 2017 | 35996543  | 5579885   |
| Август 2017 | 36218048  | 5690131 |
| Сентябрь 2017 | 36984210   | 5924759 |
| Октябрь 2017 | 38206514 | 6171478 |

Согласно предсказанию за 2 года средняя дневная аудитория сервиса Яндекс.Картинки вырастет на 1,59 млн. пользователей и достигнет 6 млн 171.5 тыс. пользователей, а месячная - на 8,77 млн. пользователей и достигнет 38 млн 206.5 тыс. пользователей. 

На протяжении всего рассматриваемого периода заметен постепенны рост посещаемости Яндекс.Картинок, кроме некоторых явлений, например, сезонных - существенного уменьшения аудитории в мае - августе, когда, предположительно, люди отправляются в отпуск и меньше используют сервис.

Предсказание посещаемости сервиса **Яндекс.Погода** на 2 года:

| Месяц.Год | Месячная аудитория | Средняя дневная аудитория|
|:-----: | :-----:| :-----: |
| Ноябрь 2015 | 15100425 | 3054056 |
| Декабрь 2015 | 15732064 | 3094691  |
| Январь 2016 | 15945993       | 3100299 |
| Февраль 2016 | 14810044  | 3111238 |
| Март 2016 | 15189175  |  3053315|
| Апрель 2016 | 15819813  |  3433944  |
| Май 2016 | 16079944  | 3509774  |
| Июнь 2016 | 16216466  | 3616995 |
| Июль 2016 | 15675845 |  3471276  |
| Август 2016 | 15105556  | 3371415 |
| Сентябрь 2016 | 14494556  | 3294739  |
| Октябрь 2016 | 14644189  | 3251186  |
| Ноябрь 2016 | 14357903  | 3324786 |
| Декабрь 2016 | 14989542 | 3365421 |
| Январь 2017 | 15203471  | 3371029  |
| Февраль 2017 | 14067522  | 3381967 |
| Март 2017 | 14446653  | 3324045  |
| Апрель 2017 | 15077291  | 3704673  |
| Май 2017 | 15337422  | 3780503  |
| Июнь 2017 | 15473944 | 3887724  |
| Июль 2017 | 14933323  | 3742006  |
| Август 2017 | 14363034  | 3642144|
| Сентябрь 2017 | 13752034  | 3565468 |
| Октябрь 2017 | 13901667 | 3521915 |

Согласно предсказанию за 2 года средняя дневная аудитория сервиса Яндекс.Погода вырастет на 454.475 тыс. пользователей и достигнет 3 млн 521.9 тыс. пользователей, а месячная к октябрю 2017 года уменьшится на 1.464 млн. пользователей и достигнет 13 млн 901.6 тыс. пользователей. 

С 2013 года заметен постепенный спад месячной аудитории Яндекс.Погоды, который может быть связан с конкуренцией на данном рынке. Однако в данном предсказании никак не учитывается нововведения, которые могут быть сделаны компанией, к примеру, уже известно, что в конце ноября 2015 года Яндекс запустил систему Метеум для предсказания погоды с точностью до дома, что может привлечь к сервису новую аудиторию и значительно повысит ежемесячный показатель.

К сожалению, на **stat.yandex.ru** сказано, что эти данные, представленные **TNS Web Index**, не учитывают мобильные устройства. Данные по посещаемости через мобильные устройства или приложения в эпоху мобильного интернета помогли бы лучше оценить аудиторию и сделать более точное предсказание. Помимо этого, как можно видеть на примере предсказания посещаемости сервиса Яндекс.Погода, информация о грядущих глобальных нововвденениях или изменениях также были бы очень полезным дополнением к имеющимся данным.
